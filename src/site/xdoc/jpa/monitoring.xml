<?xml version="1.0" encoding="iso-8859-1"?>
<document xmlns="http://maven.apache.org/XDOC/2.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/XDOC/2.0 http://maven.apache.org/xsd/xdoc-2.0.xsd">
    <properties>
        <title>JPA : Monitoring</title>
    </properties>

    <body>
        <section name="JPA : Monitoring">
            <p>
                DataNucleus allows a user to enable various MBeans internally. These can then be used for monitoring
                the number of datastore calls etc.
            </p>
            <br/>

            <subsection name="Via API">
                <p>
                    The simplest way to monitor DataNucleus is to use its API for monitoring. Internally there are several
                    MBeans (as used by JMX) and you can navigate to these to get the required information. To enable this
                    set the persistence property <b>datanucleus.enableStatistics</b> to <i>true</i>. There are then two 
                    sets of statistics; one for the EMF and one for each EM. You access these as follows
                </p>
<source><![CDATA[
JPAEntityManagerFactory dnemf = (JPAEntityManagerFactory)emf;
FactoryStatistics stats = dnemf.getNucleusContext().getStatistics();
... (access the statistics information)


JPAEntityManager dnem = (JPAEntityManager)em;
ManagerStatistics stats = dnem.getExecutionContext().getStatistics();
... (access the statistics information)
]]></source>
                <br/>
            </subsection>

            <subsection name="Using JMX">
                <p>
                    The MBeans used by DataNucleus can be accessed via JMX at runtime. 
                    More about JMX <a href="http://java.sun.com/developer/technicalArticles/J2SE/jmx.html">here</a>.
                </p>
                <p>
                    An MBean server is bundled with Sun JRE since version 1.5, and you can easily activate
                    DataNucleus MBeans registration by creating your EMF with the persistence property 
                    <b>datanucleus.jmxType</b> as <i>default</i>
                </p>
                <p>
                    Additionally, setting a few system properties are necessary for configuring the Sun JMX implementation. 
                    The minimum properties required are the following:
                </p>
                <ul>
                    <li>com.sun.management.jmxremote</li>
                    <li>com.sun.management.jmxremote.authenticate</li>
                    <li>com.sun.management.jmxremote.ssl</li>
                    <li>com.sun.management.jmxremote.port=&lt;port number&gt;</li>
                </ul>
                <p>Usage example:</p>
<source>
java -cp TheClassPathInHere
     -Dcom.sun.management.jmxremote
     -Dcom.sun.management.jmxremote.authenticate=false
     -Dcom.sun.management.jmxremote.ssl=false
     -Dcom.sun.management.jmxremote.port=8001
     TheMainClassInHere
</source>
                <p>
                    Once you start your application and DataNucleus is initialized you can browse DataNucleus MBeans using
                    a tool called jconsole (jconsole is distributed with the Sun JDK) via the URL:
                </p>
<source>service:jmx:rmi:///jndi/rmi://hostName:portNum/jmxrmi</source>
                <p>
                    Note that the mode of usage is presented in this document as matter of example, and by no means
                    we recommend to disable authentication and secured communication channels. Further details on the 
                    Sun JMX implementation and how to configure it properly can be found in 
                    <a href="http://java.sun.com/j2se/1.5.0/docs/guide/management/agent.html">here</a>.
                </p>
                <p>
                    DataNucleus MBeans are registered in a MBean Server when DataNucleus is started up 
                    (e.g. upon JPA EMF instantiation). To see the full list of DataNucleus MBeans, refer to the
                    <a href="http://www.datanucleus.org/javadocs/core/latest/org/datanucleus/management/runtime/package-summary.html">javadocs</a>.
                </p>
                <p>
                    <img src="images/mx4j.png" border="0" alt=""/>
                    To enable management using MX4J you must specify the persistence property 
                    <b>datanucleus.jmxType</b> as <i>mx4j</i> when creating the EMF, and have the 
                    <i>mx4j</i> and <i>mx4j-tools</i> jars in the CLASSPATH.
                </p>
                <br/>
            </subsection>
        </section>
    </body>
</document>